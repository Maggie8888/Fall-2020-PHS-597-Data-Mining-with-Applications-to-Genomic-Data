##########################################################################################
###############  implement cyclic coordinate descent algorithm for lasso #################
##########################################################################################
### step 1 generate data ####
rm(list=ls())
n=100
set.seed(123456789)
X<-rnorm(n,2,1)
epsilon<-rnorm(n,0,0.01)
Y<-1+2*X+3*X^2+4*X^3+epsilon
predictors<-cbind(X,X^2,X^3,X^4,X^5,X^6,X^7,X^8,X^9,X^10)
xc = sweep(predictors, 2, colMeans(predictors))
xc = sweep(predictors, 2, colMeans(predictors))
sdc = sqrt(apply(xc, 2, crossprod)/nrow(predictors))
xs = sweep(xc, 2, sdc, "/")
ys = scale(Y)*sqrt(n/(n-1))

pls<-function(x,y,A){
  b<-matrix(rep(0,dim(x)[2]*A),ncol=A,nrow=dim(x)[2])
  V=t(x)%*%y
  b[,1]=V%*%(solve((t(x%*%V)%*%(x%*%V)))%*%t(x%*%V)%*%y)
  for (a in 2:A){
    V = cbind(b, t(x)%*%(x%*%b[,a-1]))
    inv=pseudoinverse((t(x%*%V)%*%(x%*%V)))
    b[,a] = V%*%(inv%*%t(x%*%V)%*%y)
  }
  return(b)
}

library(corpcor)
res<-pls(xs,ys,10)
print(res)

###          [,1]         [,2]         [,3]         [,4]         [,5]         [,6]
##  [1,] 0.10374102  0.248608973  0.108041479  0.108042295  0.108042295  0.108042295
## [2,] 0.11197002  0.228775914  0.246127434  0.246127950  0.246127950  0.246127950
## [3,] 0.11295348  0.192276121  0.258297529  0.258297818  0.258297818  0.258297818
## [4,] 0.11111948  0.152344493  0.224179464  0.224179564  0.224179564  0.224179564
## [5,] 0.10773681  0.113182333  0.170006316  0.170006256  0.170006256  0.170006256
## [6,] 0.10346293  0.076747981  0.109175440  0.109175244  0.109175244  0.109175244
## [7,] 0.09872470  0.043996785  0.048808745  0.048808433  0.048808433  0.048808433
## [8,] 0.09382921  0.015301616 -0.007304386 -0.007304795 -0.007304795 -0.007304795
## [9,] 0.08900149 -0.009339865 -0.057358740 -0.057359230 -0.057359230 -0.057359230
## [10,] 0.08439871 -0.030171439 -0.100771066 -0.100771621 -0.100771621 -0.100771621
## [,7]         [,8]         [,9]        [,10]
## [1,]  0.108042295  0.108042295  0.108042295  0.108042295
## [2,]  0.246127950  0.246127950  0.246127950  0.246127950
## [3,]  0.258297818  0.258297818  0.258297818  0.258297818
## [4,]  0.224179564  0.224179564  0.224179564  0.224179564
## [5,]  0.170006256  0.170006256  0.170006256  0.170006256
## [6,]  0.109175244  0.109175244  0.109175244  0.109175244
## [7,]  0.048808433  0.048808433  0.048808433  0.048808433
## [8,] -0.007304795 -0.007304795 -0.007304795 -0.007304795
## [9,] -0.057359230 -0.057359230 -0.057359230 -0.057359230
## [10,] -0.100771621 -0.100771621 -0.100771621 -0.100771621

#install.packages("pls")
library(pls)
mod <- plsr(ys ~ xs)
mod$coefficients

##, , 1 comps

##ys
##X 0.10374102
##0.11197002
##0.11295348
##0.11111948
##0.10773681
##0.10346293
##0.09872470
##0.09382921
##0.08900149
##0.08439871
## , , 2 comps

##ys
##X  0.248608973
##0.228775914
##0.192276121
##0.152344493
##0.113182333
##0.076747981
##0.043996785
##0.015301616
##-0.009339865
##-0.030171439

##, , 3 comps

##ys
##X  0.108041599
##0.246127419
##0.258297473
##0.224179403
##0.170006268
##0.109175413
##0.048808741
##-0.007304366
##-0.057358700
##-0.100771006

##, , 4 comps

##ys
##X -0.009726948
##0.412207497
##0.356923110
##0.216358163
##0.088573866
##0.003442961
##-0.036746431
##-0.039550147
##-0.015002716
##0.027525111

##, , 5 comps

##ys
##X  0.01264788
##0.32267605
##0.41316120
##0.27436972
##0.10186606
##-0.02483618
##-0.08236614
##-0.07458963
##-0.01576077
##0.07798271

##, , 6 comps

##ys
##X  0.02730447
##0.19811523
##0.66199280
##0.23469330
##-0.06347271
##-0.11245017
##-0.02100761
##0.07297073
##0.07320266
##-0.06673316

##, , 7 comps

##ys
##X  0.02845150
##0.16694116
##0.79918682
##0.04850845
##-0.07768959
##0.01836086
##0.05431280
##-0.00585938
##-0.05802016
##0.03043647

##, , 8 comps

##ys
##X  0.02832224
##0.16188859
##0.84514762
##-0.08940587
##0.07728967
##0.02996910
##-0.06514252
##-0.02755859
##0.07065953
##-0.02654052

##, , 9 comps

##ys
##X  0.02806187
##0.16017841
##0.89034434
##-0.34209378
##0.71144094
##-0.70449764
##0.08192985
##0.50299321
##-0.44934061
##0.12559953

##, , 10 comps

##ys
##X  0.02763143
##0.16199599
##0.94902433
##-0.97351171
##3.50841843
##-7.54913498
##10.07227116
##-8.17826993
##3.70324622
##-0.71705781

